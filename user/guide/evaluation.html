<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="Developer documentation" href="../../developer/index.html"><link rel="prev" title="Coupled-Cluster Class" href="cc.html">

    <!-- Generated with Sphinx 7.4.7 and Furo 2025.09.25 -->
        <title>Evaluation Trace Analysis Using Nushell - SeQuant Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-treeview/bootstrap-treeview.min.css?v=8176a87d" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --sidebar-item-font-size: 0.95em;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SeQuant Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">SeQuant Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/index.html">Getting started</a><input aria-label="Toggle navigation of Getting started" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/wick.html">Wick’s Theorem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/index_spaces.html">Register Index Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/operators.html">Operators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installing.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">User Guide</a><input aria-label="Toggle navigation of User Guide" checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="operator.html">Operator Interface for Symbolic Many-Body Algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc.html">Coupled-Cluster Class</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Evaluation Trace Analysis Using Nushell</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../developer/index.html">Developer docs</a><input aria-label="Toggle navigation of Developer docs" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer/documentation.html">Documentation Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">API reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">See Also</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://valeevgroup.github.io/tiledarray">TiledArray</a></li>
<li class="toctree-l1"><a class="reference external" href="https://valeevgroup.github.io/mpqc">Massively Parallel Quantum Chemistry</a></li>
<li class="toctree-l1"><a class="reference external" href="https://valeevgroup.github.io">Valeev Research Group</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/user/guide/evaluation.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="evaluation-trace-analysis-using-nushell">
<h1>Evaluation Trace Analysis Using Nushell<a class="headerlink" href="#evaluation-trace-analysis-using-nushell" title="Link to this heading">¶</a></h1>
<p>Follow the official instructions to install <a class="reference external" href="https://www.nushell.sh/book/installation.html">Nushell</a>.</p>
<p><a class="reference download internal" download="" href="../../_downloads/7cc28d4ee8817248e3b2a795729de3f8/sequant.nu"><code class="xref download docutils literal notranslate"><span class="pre">Save</span> <span class="pre">this</span> <span class="pre">file</span></code></a> in the same directory
where the trace output file is present. We will call this directory
‘working directory’.</p>
<p>This nu script exports the functions: <code class="docutils literal notranslate"><span class="pre">trace</span> <span class="pre">eval</span></code>, <code class="docutils literal notranslate"><span class="pre">trace</span> <span class="pre">cache</span></code>,
and <code class="docutils literal notranslate"><span class="pre">trace</span> <span class="pre">term</span></code>.</p>
<p>If you are using a different shell (eg. bash, zsh, etc.), launch the
nushell from the working directory. Make sure the executable <code class="docutils literal notranslate"><span class="pre">nu</span></code>  is
on your path.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>nu
</pre></div>
</div>
<p>Then import the functions from the script.</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>use sequant.nu *
</pre></div>
</div>
<p>Now we analyze <a class="reference download internal" download="" href="../../_downloads/2e421dc980248613f3db310022fa637b/trace.txt"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">trace</span> <span class="pre">from</span> <span class="pre">this</span> <span class="pre">file</span></code></a> in steps.
This trace was generated by <code class="docutils literal notranslate"><span class="pre">mpqc4</span></code> CCSD calculation for <code class="docutils literal notranslate"><span class="pre">He16</span></code> chain using
<code class="docutils literal notranslate"><span class="pre">cc-pVTZ</span></code> basis. The trace is for the very first iteration. The mpqc output file without
the SeQuant evaluation trace is <a class="reference download internal" download="" href="../../_downloads/948842289b7d709f6b38708cba9682e0/mpqc_out.txt"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<p>A trace line produced by the evaluator is one of the three kinds: an <strong>evaluation</strong>,
a <strong>cache</strong> interaction, and a term indicator when the evaluation of a <strong>term</strong> starts
or ends.</p>
<section id="analysis-of-evaluation-steps">
<h2>Analysis of evaluation steps<a class="headerlink" href="#analysis-of-evaluation-steps" title="Link to this heading">¶</a></h2>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>let eval = trace eval trace.txt
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">$eval</span></code> variable is a table that contains trace from evaluation
steps.</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | columns
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬────────╮
│ 0 │ tag0   │
│ 1 │ tag1   │
│ 2 │ time   │
│ 3 │ memory │
│ 4 │ annot  │
│ 5 │ line   │
╰───┴────────╯
</pre></div>
</div>
<p>Let’s look at the unique entries of the <code class="docutils literal notranslate"><span class="pre">tag1</span></code> column:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | get tag1 | uniq
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬────────────╮
│ 0 │ Tensor     │
│ 1 │ Permute    │
│ 2 │ Product    │
│ 3 │ Constant   │
│ 4 │ SumInplace │
│ 5 │ Symmetrize │
╰───┴────────────╯
</pre></div>
</div>
<p>Now let’s look at the first few entries. Note that the last column <code class="docutils literal notranslate"><span class="pre">line</span></code> is the line number
in the output file (<code class="docutils literal notranslate"><span class="pre">trace.txt</span></code> in our case).</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | first 10
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬────────────┬───────────────────┬─────────┬───────────────────────────────────────┬──────╮
│ # │ tag0 │    tag1    │       time        │ memory  │                 annot                 │ line │
├───┼──────┼────────────┼───────────────────┼─────────┼───────────────────────────────────────┼──────┤
│ 0 │ Eval │ Tensor     │     6ms 3µs 295ns │ 36.7 kB │ f(a_1,i_1)                            │    2 │
│ 1 │ Eval │ Permute    │       195µs 598ns │ 73.5 kB │ f(a_1,i_1)                            │    3 │
│ 2 │ Eval │ Tensor     │ 119ms 317µs 395ns │ 10.7 kB │ f(i_2,i_1)                            │    6 │
│ 3 │ Eval │ Tensor     │         1µs 613ns │ 36.7 kB │ t(a_1,i_2)                            │    7 │
│ 4 │ Eval │ Product    │   6ms 789µs 630ns │ 84.2 kB │ f(i_2,i_1) * t(a_1,i_2) -&gt; I(a_1,i_1) │    8 │
│ 5 │ Eval │ Constant   │         3µs 296ns │     8 B │ {{{-1}}}                              │    9 │
│ 6 │ Eval │ Product    │       199µs 284ns │ 73.5 kB │ I(a_1,i_1) * {{{-1}}} -&gt; I(a_1,i_1)   │   10 │
│ 7 │ Eval │ Permute    │       755µs 948ns │ 73.5 kB │ I(a_1,i_1)                            │   11 │
│ 8 │ Eval │ SumInplace │    3ms 32µs 326ns │ 73.5 kB │ I(a_1,i_1)                            │   13 │
│ 9 │ Eval │ Tensor     │   6ms 265µs 660ns │ 36.7 kB │ f(i_2,a_2)                            │   15 │
╰───┴──────┴────────────┴───────────────────┴─────────┴───────────────────────────────────────┴──────╯
</pre></div>
</div>
<p>Listing top five time-consuming steps:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | sort-by time --reverse | first 5
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬─────────┬────────────────────────┬─────────┬───────────────────────────────────────────────────────────────┬──────╮
│ # │ tag0 │  tag1   │          time          │ memory  │                             annot                             │ line │
├───┼──────┼─────────┼────────────────────────┼─────────┼───────────────────────────────────────────────────────────────┼──────┤
│ 0 │ Eval │ Tensor  │ 2sec 732ms 827µs 727ns │ 14.9 GB │ g(a_1,a_2,a_3,a_4)                                            │  260 │
│ 1 │ Eval │ Product │ 1sec 302ms 417µs 788ns │ 15.1 GB │ g(a_1,a_2,a_3,a_4) * t(a_3,a_4,i_1,i_2) -&gt; I(a_2,a_1,i_2,i_1) │  262 │
│ 2 │ Eval │ Product │  1sec 95ms 839µs 314ns │ 16.1 GB │ g(a_1,a_2,a_3,a_4) * t(a_3,i_1) -&gt; I(a_2,a_1,i_1,a_4)         │  382 │
│ 3 │ Eval │ Tensor  │      688ms 998µs 813ns │ 88.7 MB │ g(i_2,a_1,i_1,a_2)                                            │   24 │
│ 4 │ Eval │ Tensor  │      280ms 151µs 443ns │  1.1 GB │ g(i_2,a_1,a_2,a_3)                                            │   51 │
╰───┴──────┴─────────┴────────────────────────┴─────────┴───────────────────────────────────────────────────────────────┴──────╯
</pre></div>
</div>
<p>Listing top five memory-consuming steps:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | sort-by memory --reverse | first 5
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬─────────┬────────────────────────┬─────────┬───────────────────────────────────────────────────────────────┬──────╮
│ # │ tag0 │  tag1   │          time          │ memory  │                             annot                             │ line │
├───┼──────┼─────────┼────────────────────────┼─────────┼───────────────────────────────────────────────────────────────┼──────┤
│ 0 │ Eval │ Product │  1sec 95ms 839µs 314ns │ 16.1 GB │ g(a_1,a_2,a_3,a_4) * t(a_3,i_1) -&gt; I(a_2,a_1,i_1,a_4)         │  382 │
│ 1 │ Eval │ Product │ 1sec 302ms 417µs 788ns │ 15.1 GB │ g(a_1,a_2,a_3,a_4) * t(a_3,a_4,i_1,i_2) -&gt; I(a_2,a_1,i_2,i_1) │  262 │
│ 2 │ Eval │ Tensor  │             25µs 840ns │ 14.9 GB │ g(a_1,a_2,a_3,a_4)                                            │  380 │
│ 3 │ Eval │ Tensor  │ 2sec 732ms 827µs 727ns │ 14.9 GB │ g(a_1,a_2,a_3,a_4)                                            │  260 │
│ 4 │ Eval │ Product │      188ms 365µs 620ns │  1.2 GB │ g(i_3,a_1,a_3,a_4) * t(a_3,a_4,i_2,i_1) -&gt; I(i_3,a_1,i_2,i_1) │  466 │
╰───┴──────┴─────────┴────────────────────────┴─────────┴───────────────────────────────────────────────────────────────┴──────╯
</pre></div>
</div>
<p>The sum total of the time column:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | get time | math sum
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">16</span><span class="n">sec</span> <span class="mi">693</span><span class="n">ms</span> <span class="mi">188</span><span class="n">µs</span> <span class="mi">413</span><span class="n">ns</span>
</pre></div>
</div>
</section>
<section id="analysis-of-cache-interaction">
<h2>Analysis of cache interaction<a class="headerlink" href="#analysis-of-cache-interaction" title="Link to this heading">¶</a></h2>
<p>Parsing the cache trace:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>let cache = trace cache trace.txt
</pre></div>
</div>
<p>Let’s take a look at the first few lines:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$cache | first 5
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬───────┬─────────┬──────────────────────┬──────┬────────┬─────────┬──────╮
│ # │ tag0  │  tag1   │         key          │ life │ nalive │ memory  │ line │
├───┼───────┼─────────┼──────────────────────┼──────┼────────┼─────────┼──────┤
│ 0 │ Cache │ Store   │ 6443766742777296727  │ 2/3  │      2 │ 36.7 kB │   95 │
│ 1 │ Cache │ Store   │ 14406268377898944426 │ 1/2  │      3 │  6.9 MB │  116 │
│ 2 │ Cache │ Store   │ 4354995230928331310  │ 2/3  │      5 │  7.0 MB │  137 │
│ 3 │ Cache │ Access  │ 4354995230928331310  │ 1/3  │      4 │  7.0 MB │  155 │
│ 4 │ Cache │ Release │ 14406268377898944426 │ 0/2  │      3 │ 73.5 kB │  195 │
╰───┴───────┴─────────┴──────────────────────┴──────┴────────┴─────────┴──────╯
</pre></div>
</div>
<p>An entry is identified by the <code class="docutils literal notranslate"><span class="pre">key</span></code> in the cache. From the table we
see that the first cache interaction was to store an intermediate. Turns out the
intermediate is allowed only three accesses before it is released from the cache.
Since we stored, and immediately accessed it as part of the evaluation step, we see the
life of this intermediate is <code class="docutils literal notranslate"><span class="pre">2/3</span></code>. Because no other entries have been added to the
cache at this point the total number of alive entries is <code class="docutils literal notranslate"><span class="pre">2</span></code> as seen from the
<code class="docutils literal notranslate"><span class="pre">nalive</span></code> column. The memory used by the cache which is the sum of the alive entries
is given in the <code class="docutils literal notranslate"><span class="pre">memory</span></code> column.</p>
<p>Next, another intermediate is stored in the cache. Since there are two alive entries
already, this brings the <code class="docutils literal notranslate"><span class="pre">nalive</span></code> to three. The cache memory reaches to 6.9 MB,
implying the intermediate that was just stored is ~6.8 MB in size. We can see from
the last row the same intermediate is released.</p>
<p>We can see what was the peak memory use by the cache:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$cache | sort-by memory --reverse | take 1
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬───────┬───────┬─────────────────────┬──────┬────────┬──────────┬──────╮
│ # │ tag0  │ tag1  │         key         │ life │ nalive │  memory  │ line │
├───┼───────┼───────┼─────────────────────┼──────┼────────┼──────────┼──────┤
│ 0 │ Cache │ Store │ 1502144429761737779 │ 1/2  │      5 │ 267.4 MB │  575 │
╰───┴───────┴───────┴─────────────────────┴──────┴────────┴──────────┴──────╯
</pre></div>
</div>
</section>
<section id="analysis-of-the-terms">
<h2>Analysis of the terms<a class="headerlink" href="#analysis-of-the-terms" title="Link to this heading">¶</a></h2>
<p>We can see when the evaluation of a term began and ended. Let’s start by parsing
the terms related trace.</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>let term = trace term trace.txt
</pre></div>
</div>
<p>Let’s take a look at the first few entries:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$term | first 5
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬───────┬─────┬────────────────────────────────────────────────╮
│ # │ tag0 │ begin │ end │                      expr                      │
├───┼──────┼───────┼─────┼────────────────────────────────────────────────┤
│ 0 │ Term │     1 │   4 │ f{a_1;i_1}:N-C-S                               │
│ 1 │ Term │     5 │  12 │ -1 f{i_2;i_1}:N-C-S * t{a_1;i_2}:N-C-S         │
│ 2 │ Term │    14 │  21 │ 2 f{i_2;a_2}:N-C-S * t{a_1,a_2;i_1,i_2}:N-C-S  │
│ 3 │ Term │    23 │  30 │ -1 g{i_2,a_1;i_1,a_2}:N-C-S * t{a_2;i_2}:N-C-S │
│ 4 │ Term │    32 │  39 │ 2 g{i_2,a_1;a_2,i_1}:N-C-S * t{a_2;i_2}:N-C-S  │
╰───┴──────┴───────┴─────┴────────────────────────────────────────────────╯
</pre></div>
</div>
<p>From this table we can identify which term did the particular evaluation step,
or the cache interaction step belonged to. The <code class="docutils literal notranslate"><span class="pre">expr</span></code> column has the term printed out
as a string that can be parsed by SeQuant. For example, the second last entry
tells that the trace produced between the line numbers 23 and 30 belongs to
the term <code class="docutils literal notranslate"><span class="pre">-1</span> <span class="pre">g{i_2,a_1;i_1,a_2}:N-C-S</span> <span class="pre">*</span> <span class="pre">t{a_2;i_2}:N-C-S</span></code>.</p>
<p>The evaluation steps that belong to this term are:</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$eval | where line in 23..30
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬──────────┬───────────────────┬─────────┬───────────────────────────────────────────────┬──────╮
│ # │ tag0 │   tag1   │       time        │ memory  │                     annot                     │ line │
├───┼──────┼──────────┼───────────────────┼─────────┼───────────────────────────────────────────────┼──────┤
│ 0 │ Eval │ Tensor   │ 688ms 998µs 813ns │ 88.7 MB │ g(i_2,a_1,i_1,a_2)                            │   24 │
│ 1 │ Eval │ Tensor   │         2µs 424ns │ 36.7 kB │ t(a_2,i_2)                                    │   25 │
│ 2 │ Eval │ Product  │  31ms 669µs 619ns │ 88.8 MB │ g(i_2,a_1,i_1,a_2) * t(a_2,i_2) -&gt; I(a_1,i_1) │   26 │
│ 3 │ Eval │ Constant │         1µs 553ns │     8 B │ {{{-1}}}                                      │   27 │
│ 4 │ Eval │ Product  │       181µs 701ns │ 73.5 kB │ I(a_1,i_1) * {{{-1}}} -&gt; I(a_1,i_1)           │   28 │
│ 5 │ Eval │ Permute  │    1ms 18µs 213ns │ 73.5 kB │ I(a_1,i_1)                                    │   29 │
╰───┴──────┴──────────┴───────────────────┴─────────┴───────────────────────────────────────────────┴──────╯
</pre></div>
</div>
<p>We can also go in reverse. We saw from the result of <code class="docutils literal notranslate"><span class="pre">$cache</span> <span class="pre">|</span> <span class="pre">first</span> <span class="pre">5</span></code> that an
intermediate of ~6.8 MB size is stored to the cache at line number 116. We can find
out what term produced this intermediate.</p>
<div class="highlight-nu notranslate"><div class="highlight"><pre><span></span>$term | where begin &lt; 116 | where end &gt; 116
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───┬──────┬───────┬─────┬──────────────────────────────────────────────────────────────────────────╮
│ # │ tag0 │ begin │ end │                                   expr                                   │
├───┼──────┼───────┼─────┼──────────────────────────────────────────────────────────────────────────┤
│ 0 │ Term │   112 │ 120 │ (g{i_2,i_3;a_2,a_3}:N-C-S * t{a_2;i_1}:N-C-S) * t{a_1,a_3;i_3,i_2}:N-C-S │
╰───┴──────┴───────┴─────┴──────────────────────────────────────────────────────────────────────────╯
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../developer/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Developer documentation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="cc.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Coupled-Cluster Class</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, SeQuant developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 24, 2025 6:26:19 AM</div>
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link fa-brands fa-solid fa-github fa-2x" href="https://github.com/ValeevGroup/SeQuant" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Evaluation Trace Analysis Using Nushell</a><ul>
<li><a class="reference internal" href="#analysis-of-evaluation-steps">Analysis of evaluation steps</a></li>
<li><a class="reference internal" href="#analysis-of-cache-interaction">Analysis of cache interaction</a></li>
<li><a class="reference internal" href="#analysis-of-the-terms">Analysis of the terms</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/bootstrap-treeview/bootstrap-treeview.min.js?v=6a1e96b4"></script>
    </body>
</html>